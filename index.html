<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pomiary parametrów zdrowotnych</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./css/reset.css" />
    <link rel="stylesheet" href="./css/main.css" />
  </head>
  <body class="preloading">
    <header id="header" class="main-header"></header>
    <div id="loader" class="loader">Ładowanie...</div>
    <main>
      <!-- Logowanie -->
      <div id="login-page" class="hidden">
        <h1>Logowanie do Moich Pomiarów</h1>
        <form id="login-form">
          <label for="login-email">Email:</label>
          <input type="email" id="login-email" required />

          <label for="login-password">Hasło:</label>
          <input type="password" id="login-password" required />

          <button type="submit" class="btn login-btn">Zaloguj</button>
        </form>
      </div>
    </main>

    <script type="module">
      import { auth } from "./js/firebase-auth.js";
      import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";

      const loader = document.getElementById("loader");
      const loginPage = document.getElementById("login-page");

      // fetch headera
      fetch("header.html")
        .then((res) => res.text())
        .then((html) => {
          document.getElementById("header").innerHTML = html;
          const navLinks = document.querySelector(".nav-links");
          const logoutBtn = document.getElementById("logoutBtn");

          // ustaw widoczność przycisku logout i navLinks
          onAuthStateChanged(auth, (user) => {
            document.body.classList.remove("preloading"); // usuń klasę blokującą

            if (loader) loader.style.display = "none";

            if (user) {
              // Użytkownik zalogowany → przekierowanie na measurements.html
              window.location.href = "measurements.html";
            } else {
              // Pokaż formularz logowania
              loginPage.classList.remove("hidden");

              if (navLinks) navLinks.style.display = "none";
              if (logoutBtn) logoutBtn.style.display = "none";
            }
          });

          // listener wylogowania
          if (logoutBtn) {
            import("./js/firebase-auth.js").then(({ logoutUser }) => {
              logoutBtn.addEventListener("click", () => {
                logoutUser();
              });
            });
          }
        });
    </script>

    <script type="module" src="./js/firebase-auth.js"></script>
  </body>
</html>
